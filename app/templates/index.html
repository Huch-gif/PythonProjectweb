{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card text-center shadow-lg border-0">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="card-header bg-gradient text-white py-4">
          <h1 class="h3 mb-0">üí• –°–£–ü–ï–† –ö–õ–ò–ö–ï–† üí•</h1>
        </div>

        <!-- –¢–µ–ª–æ -->
        <div class="card-body">
          <!-- –°—á—ë—Ç—á–∏–∫ -->
          <p class="lead mb-4">
            <strong>–ö–ª–∏–∫–æ–≤:</strong>
            <span class="text-danger" style="font-size: 2rem;">{{ current_user.clicks }}</span>
          </p>

          <!-- –ö–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞ -->
          <a href="{{ url_for('click') }}"
             id="click-btn"
             class="btn btn-warning btn-lg"
             style="font-size: 2rem; padding: 30px 70px; border-radius: 15px;
                    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                    transition: transform 0.1s;">
             üî• –ö–õ–ò–ö!
          </a>

          <p class="text-muted mt-3">–ù–∞–∂–º–∏ ‚Äî –∏ –∑–∞–ø—É—Å—Ç–∏ –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å!</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π –∞—É–¥–∏–æ -->
<audio id="explosion-sound" preload="auto">
  <source src="https://www.soundjay.com/misc/sounds/explosion-01.mp3" type="audio/mpeg">
</audio>

<!-- –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏ -->
<div id="flash" style="
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  background: white; opacity: 0;
  pointer-events: none; z-index: 9999;
  transition: opacity 0.3s ease-out;
"></div>

<script>
  // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
  const explosionSound = document.getElementById('explosion-sound');
  const flash = document.getElementById('flash');
  const clickBtn = document.getElementById('click-btn');

  // –§–ª–∞–≥: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ª–∏ –∑–≤—É–∫
  let soundInitialized = false;

  // –§—É–Ω–∫—Ü–∏—è: –ø—Ä–æ–∏–≥—Ä–∞—Ç—å –≤–∑—Ä—ã–≤
  function playExplosion() {
    if (!soundInitialized) {
      // –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞: —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
      explosionSound.play().then(() => {
        soundInitialized = true;
      }).catch(() => {
        // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
        // (–∏–Ω–æ–≥–¥–∞ Chrome —Ç—Ä–µ–±—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, –Ω–æ –ø–æ—Ç–æ–º —Ä–∞–∑—Ä–µ—à–∞–µ—Ç)
        soundInitialized = true;
      });
    } else {
      // –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥—Ä–∞–µ–º
      explosionSound.currentTime = 0;
      explosionSound.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è'));
    }

    // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
    flash.style.opacity = 0.8;
    setTimeout(() => {
      flash.style.opacity = 0;
    }, 150);
  }

  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
  if (clickBtn) {
    clickBtn.addEventListener('click', playExplosion);
  }
</script>

<style>
  #click-btn:active {
    transform: scale(0.9);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }
  .bg-gradient {
    background: linear-gradient(45deg, #d32f2f, #ff8a65);
  }
</style>

{% endblock %}